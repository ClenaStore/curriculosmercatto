<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Cadastro de Currículos • Mercatto Delícia</title>
  <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Inter', sans-serif;
      background: #0b0f19;
      color: #f8fafc;
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      margin: 0;
      padding: 20px;
    }
    form {
      background: #151d2f;
      padding: 30px;
      border-radius: 16px;
      max-width: 460px;
      width: 100%;
      box-shadow: 0 0 20px rgba(0,0,0,0.4);
    }
    h2 {
      text-align: center;
      color: #facc15;
      margin-bottom: 25px;
    }
    label { display: block; margin: 12px 0 4px; font-weight: 600; }
    input, select, button {
      width: 100%;
      padding: 12px;
      border-radius: 10px;
      border: 1px solid #243043;
      background: #0f172a;
      color: #f1f5f9;
      font-size: 15px;
    }
    button {
      background: #facc15;
      color: #111;
      border: none;
      font-weight: 700;
      cursor: pointer;
      transition: 0.3s;
      margin-top: 14px;
    }
    button:hover { opacity: 0.9; }
    progress {
      width: 100%;
      height: 8px;
      border-radius: 8px;
      margin-top: 10px;
      appearance: none;
    }
    progress::-webkit-progress-bar { background: #1e293b; border-radius: 8px; }
    progress::-webkit-progress-value { background: #facc15; border-radius: 8px; }
    .msg { text-align: center; margin-top: 10px; font-size: 14px; }
  </style>
</head>
<body>

  <form id="curriculoForm">
    <h2>Cadastre seu currículo</h2>

    <label>Nome completo *</label>
    <input type="text" id="nome" required>

    <label>Idade *</label>
    <input type="number" id="idade" required min="14">

    <label>Área de interesse *</label>
    <select id="area" required>
      <option value="">Selecione</option>
      <option>Cozinha</option>
      <option>Atendimento</option>
      <option>Serviços Gerais</option>
      <option>Administração</option>
    </select>

    <label>Anexar currículo (PDF, DOC ou DOCX)</label>
    <input type="file" id="arquivo" accept=".pdf,.doc,.docx" required>

    <progress id="progresso" value="0" max="100" style="display:none;"></progress>

    <button type="submit">Enviar Currículo</button>
    <div class="msg" id="mensagem"></div>
  </form>

  <script>
    const ENDPOINT = "https://script.google.com/macros/s/AKfycbxyY4rYnv3qK2UWbV7dHl4ABd2NOYAFVHMgz_HQB2RngKu-l_dcr3Xz1v4MpirB3JnW/exec";

    const form = document.getElementById("curriculoForm");
    const msg = document.getElementById("mensagem");
    const barra = document.getElementById("progresso");

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      msg.textContent = "";
      barra.value = 0;
      barra.style.display = "block";

      const nome = document.getElementById("nome").value.trim();
      const idade = document.getElementById("idade").value.trim();
      const area = document.getElementById("area").value;
      const file = document.getElementById("arquivo").files[0];

      if (!file) {
        msg.textContent = "Selecione um arquivo válido.";
        return;
      }

      // Lê arquivo como base64 com barra de progresso
      const base64 = await new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = () => resolve(reader.result.split(",")[1]);
        reader.onerror = reject;
        reader.readAsDataURL(file);
        reader.onprogress = (ev) => {
          if (ev.lengthComputable) {
            barra.value = (ev.loaded / ev.total) * 100;
          }
        };
      });

      msg.textContent = "Enviando dados...";

      try {
        const resp = await fetch(ENDPOINT, {
          method: "POST",
          body: JSON.stringify({
            nome, idade, area,
            nomeArquivo: file.name,
            arquivo: base64
          }),
        });

        const data = await resp.json();
        if (data.sucesso) {
          msg.textContent = "✅ Currículo enviado com sucesso!";
          form.reset();
          barra.value = 100;
        } else {
          msg.textContent = "⚠️ Erro: " + (data.erro || "Falha ao enviar.");
        }
      } catch (err) {
        msg.textContent = "⚠️ Erro de rede: " + err.message;
      } finally {
        setTimeout(() => (barra.style.display = "none"), 2000);
      }
    });
  </script>
</body>
</html>
